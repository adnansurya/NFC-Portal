<!DOCTYPE html>
<html lang="en">

<head>

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="">

  <title> NFC Parking </title>

  <!-- The core Firebase JS SDK is always required and must be listed first -->
  <script src="https://www.gstatic.com/firebasejs/6.6.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/6.6.1/firebase-database.js"></script>

  <!-- Custom fonts for this template -->
  <link href="vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i" rel="stylesheet">

  <!-- Custom styles for this template -->
  <link href="css/sb-admin-2.min.css" rel="stylesheet">

  <!-- Custom styles for this page -->
  <link href="vendor/datatables/dataTables.bootstrap4.min.css" rel="stylesheet">

  <!-- TODO: Add SDKs for Firebase products that you want to use
        https://firebase.google.com/docs/web/setup#config-web-app -->

    <script>
    // Your web app's Firebase configuration
    var firebaseConfig = {
    apiKey: "AIzaSyCx6AdfG2fje0BXshS4koOw02GYTxH9ots",
    authDomain: "myclasswebsite-3eca2.firebaseapp.com",
    databaseURL: "https://myclasswebsite-3eca2.firebaseio.com",
    projectId: "myclasswebsite-3eca2",
    storageBucket: "myclasswebsite-3eca2.appspot.com",
    messagingSenderId: "779841356082",
    appId: "1:779841356082:web:e8f8e288c0feeb1025572b",
    };
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    </script>
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>

</head>

<body id="page-top">

  <!-- Page Wrapper -->
  <div id="wrapper">

    <!-- Sidebar -->
    <ul class="navbar-nav bg-gradient-primary sidebar sidebar-dark accordion" id="accordionSidebar">

      <!-- Sidebar - Brand -->
      <a class="sidebar-brand d-flex align-items-center justify-content-center" href="index.html">
        <div class="sidebar-brand-icon rotate-n-15">
          <i class="fas fa-laugh-wink"></i>
        </div>
        <div class="sidebar-brand-text mx-3"> NFC Parking </div>
      </a>

      <!-- Divider -->
      <hr class="sidebar-divider my-0">

      <!-- Nav Item - Dashboard -->
      <li class="nav-item">
        <a class="nav-link" href="index.html">
          <i class="fas fa-fw fa-tachometer-alt"></i>
          <span>Dashboard</span></a>
      </li>

      <!-- Divider -->
      <hr class="sidebar-divider">

      <!-- Heading -->
      <div class="sidebar-heading">
        Addons
      </div>

      <!-- Nav Item - Pages Collapse Menu -->
      <li class="nav-item">
        <a class="nav-link collapsed" href="inputData.html">
          <i class="fas fa-fw fa-folder"></i>
          <span> Input Data </span>
        </a>
      </li>

      <!-- Nav Item - Charts -->
      <li class="nav-item active">
        <a class="nav-link" href="charts.html">
          <i class="fas fa-fw fa-chart-area"></i>
          <span> Data User </span></a>
      </li>

      <!-- Nav Item - Tables -->
      <li class="nav-item">
        <a class="nav-link" href="tables.html">
          <i class="fas fa-fw fa-table"></i>
          <span> Log </span></a>
      </li>

      <!-- Divider -->
      <hr class="sidebar-divider d-none d-md-block">

      <!-- Sidebar Toggler (Sidebar) -->
      <div class="text-center d-none d-md-inline">
        <button class="rounded-circle border-0" id="sidebarToggle"></button>
      </div>

    </ul>
    <!-- End of Sidebar -->

    <!-- Content Wrapper -->
    <div id="content-wrapper" class="d-flex flex-column">

      <!-- Main Content -->
      <div id="content">

        <!-- Topbar -->
        <nav class="navbar navbar-expand navbar-light bg-white topbar mb-4 static-top shadow">

          <!-- Sidebar Toggle (Topbar) -->
          <button id="sidebarToggleTop" class="btn btn-link d-md-none rounded-circle mr-3">
            <i class="fa fa-bars"></i>
          </button>

          <!-- Topbar Navbar -->
          <ul class="navbar-nav ml-auto">

            <div class="topbar-divider d-sm-block"></div>

            <!-- Nav Item - User Information -->
            <li class="nav-item dropdown no-arrow">
              <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <span class="mr-2 d-lg-inline text-gray-600"> Admin </span>
              </a>
              <!-- Dropdown - User Information -->
              <div class="dropdown-menu dropdown-menu-right shadow animated--grow-in" aria-labelledby="userDropdown">
                <a class="dropdown-item" href="#">
                  <i class="fas fa-user fa-sm fa-fw mr-2 text-gray-400"></i>
                  Profile
                </a>
                <div class="dropdown-divider"></div>
                <a class="dropdown-item" href="#" data-toggle="modal" data-target="#logoutModal">
                  <i class="fas fa-sign-out-alt fa-sm fa-fw mr-2 text-gray-400"></i>
                  Logout
                </a>
              </div>
            </li>

          </ul>

        </nav>
        <!-- End of Topbar -->

        <!-- Begin Page Content -->
        <div class="container-fluid">

          <!-- Page Heading -->
          <h1 class="h3 mb-2 text-gray-800">Tables</h1>
          <p class="mb-4">DataTables is a third party plugin that is used to generate the demo table below. For more information about DataTables, please visit the <a target="_blank" href="https://datatables.net">official DataTables documentation</a>.</p>

          <!-- DataTales Example -->
          <div class="card shadow mb-4">
            <div class="card-header py-3">
              <h6 class="m-0 font-weight-bold text-primary">DataTables Example</h6>
            </div>
            <div class="card-body">
              <div class="table-responsive">
                <table class="table table-bordered" id="tabelBody" width="100%" cellspacing="1">
                  <thead>
                    <tr>
                      <th> Nama </th>
                      <th> Alamat </th>
                      <th> Identitas </th>
                      <th> Profesi </th>
                      <th> Action </th>
                    </tr>
                  </thead>
                  <tbody></tbody>
                </table>
              </div>
            </div>
          </div>
      
      <!-- Detail Modal -->
          <div class="modal fade" id="detailModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog" role="document">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="exampleModalLabel"> Details </h5>
                  <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">×</span>
                  </button>
                </div>

                <!-- Modal Details -->
                <div class="modal-body" id="modalDetails">
                  
                </div>
                <div class="modal-footer">
                  <button class="btn btn-secondary" type="button" data-dismiss="modal">Cancel</button>
                </div>
              </div>
            </div>
          </div>

          <!-- Edit Modal -->
            <div class="modal fade" id="editModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
              <div class="modal-dialog" role="document">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel"> Edit the Data </h5>
                    <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                      <span aria-hidden="true">×</span>
                    </button>
                  </div>

                  <!-- Modal Edit -->
                  <div class="modal-body" id="modalEdits">
                    
                  </div>
                  
                </div>
              </div>
            </div>

            <!-- Delete Modal -->
              <div class="modal fade" id="deleteModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5 class="modal-title" id="exampleModalLabel"> Ouh Noo !! </h5>
                      <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">×</span>
                      </button>
                    </div>
                    <div class="modal-body" id="modalDelete">
                      
                    </div>
                    
                  </div>
                </div>
              </div>

        </div>
        <!-- /.container-fluid -->

      </div>
      <!-- End of Main Content -->

      <!-- Footer -->
      <footer class="sticky-footer bg-white">
        <div class="container my-auto">
          <div class="copyright text-center my-auto">
            <span>Copyright &copy; Your Website 2019</span>
          </div>
        </div>
      </footer>

    </div>
    <!-- End of Content Wrapper -->

  </div>
  <!-- End of Page Wrapper -->

  <!-- Scroll to Top Button-->
  <a class="scroll-to-top rounded" href="#page-top">
    <i class="fas fa-angle-up"></i>
  </a>

  <!-- Logout Modal-->
  <div class="modal fade" id="logoutModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Ready to Leave?</h5>
          <button class="close" type="button" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">×</span>
          </button>
        </div>
        <div class="modal-body">Select "Logout" below if you are ready to end your current session.</div>
        <div class="modal-footer">
          <button class="btn btn-secondary" type="button" data-dismiss="modal">Cancel</button>
          <a class="btn btn-primary" href="login.html">Logout</a>
        </div>
      </div>
    </div>
  </div>

<!-- FIREBASE CONFIG -->

  <!-- Bootstrap core JavaScript-->
  <script src="vendor/jquery/jquery.min.js"></script>
  <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

  <!-- Core plugin JavaScript-->
  <script src="vendor/jquery-easing/jquery.easing.min.js"></script>

  <!-- Custom scripts for all pages-->
  <script src="js/sb-admin-2.min.js"></script>

  <!-- Page level plugins -->
  <script src="vendor/datatables/jquery.dataTables.min.js"></script>
  <script src="vendor/datatables/dataTables.bootstrap4.min.js"></script>

  <!-- Page level custom scripts -->
  <script src="js/demo/datatables-demo.js"></script>

  <script src="script.js"></script>

  <script>

  let usersObj;

  db.ref('Users').once('value').then(function(snapshot) {

    usersObj = snapshot.val();

    snapshot.forEach(function(data) {
      let satuId = data.val();

      $('#tabelBody').append(`
        <tr>
          <td>` + satuId.nama + `</td>
          <td>` + satuId.alamat + `</td>
          <td>` + satuId.identitas + `</td>
          <td>` + satuId.profesi + `</td>
          <td>
          <!-- Detail Button -->
          <a type="button" class="btn btn-primary" href="#" data-toggle="modal" data-target="#detailModal" data-child-id="`+ data.key +`">
            Details
          </a>
          <!-- Edit Button -->
          <a type="button" class="btn btn-warning" href="#" data-toggle="modal" data-target="#editModal" data-child-id="` + data.key + `">
            Edit
          </a>
          <!-- Delete Button -->
          <a type="button" class="btn btn-danger" href="#" data-toggle="modal" data-target="#deleteModal" data-child-id="` +data.key+ `">
            Delete
          </a>
          </td>
        </tr>

      `);

    });
  });
 
 // ------------------------------ DETAILS MODAL ------------------------------
  $('#detailModal').on('show.bs.modal', function(e) {
  
    let childId = $(e.relatedTarget).data('child-id');
  
    $('#modalDetails').append(`
        <p> Id NFC : ` + childId + `</p> 
        <p> Agama : ` + usersObj[childId].agama  + `</p>
        <p> Alamat : ` + usersObj[childId].alamat  + `</p>                     
        <p> Identitas : ` + usersObj[childId].identitas  + `</p>              
        <p> Jenis Kelamin : ` + usersObj[childId].jKel  + `</p>              
        <p> Kewarganegaraan : ` + usersObj[childId].kNegara  + `</p>              
        <p> Kecamatan : ` + usersObj[childId].kecamatan + `</p>              
        <p> Kelurahan / Desa : ` + usersObj[childId].kelDes + `</p>              
        <p> Kenalan : ` + usersObj[childId].kenalan + `</p>              
        <p> Nama : ` + usersObj[childId].nama + `</p>              
        <p> Profesi : ` + usersObj[childId].profesi + `</p>              
        <p> RT(Rukun Tetangga) : ` + usersObj[childId].rt + `</p>              
        <p> RW(Rukun Warga) : ` + usersObj[childId].rw + `</p>              
        <p> Status Perkawinan : ` + usersObj[childId].status + `</p>              
        <p> Tempat Lahir : ` + usersObj[childId].tpLahir + `</p>              
        <p> Tanggal Lahir : ` + usersObj[childId].tgLahir + `</p>              
        <p> Umur : ` + usersObj[childId].umur + `</p>              
    `); 
  });
  // ------------------------------ END OF DETAILS MODAL -----------------------------------

  // ------------------ EDIT MODAL -------------------------
  $('#editModal').on('show.bs.modal', function(e) {

    let childId = $(e.relatedTarget).data('child-id');

    $('#modalEdits').append(`
      <form class="user">
          <div class="form-group">
            <h5 class="font-weight-bold mb-3"> Id NFC </h5>
            <h6 class=""> `+ childId +` </h6>
            <input type="hidden" class="form-control form-control-user" id="idNFC" placeholder="IdNFC" value="`+ childId +`">
          </div>
          <div class="form-group">
            <h5 class="font-weight-bold mb-3"> Nama </h5>
            <input type="text" class="form-control form-control-user" id="namaOrang" placeholder="Nama" value="`+ usersObj[childId].nama +`">
          </div>
          <div class="form-group">
            <h5 class="font-weight-bold mb-3"> Umur </h5>
            <input type="text" class="form-control form-control-user" id="umur" placeholder="umur" value="`+ usersObj[childId].umur +`">
          </div>
          <div class="form-group">
            <h5 class="font-weight-bold mb-3"> Tempat Lahir </h5>
            <input type="text" class="form-control form-control-user" id="tpLahir" placeholder="Tempat Lahir" value="`+ usersObj[childId].tpLahir +`">
          </div>
          <div class="form-group">
            <h5 class="font-weight-bold mb-3"> Tanggal Lahir </h5>
            <input type="date" class="form-control form-control-user" id="tgLahir" placeholder="Tanggal Lahir" value="`+ usersObj[childId].tgLahir +`">
          </div>
          <div class="form-group">
            <h5 class="font-weight-bold mb-3"> Jenis Kelamin </h5>
            <input type="text" class="form-control form-control-user" id="jKel" placeholder="Jenis Kelamin" value="`+ usersObj[childId].jKel +`">
          </div>
          <div class="form-group">
            <h5 class="font-weight-bold mb-3"> Alamat </h5>
            <input type="text" class="form-control form-control-user" id="alamat" placeholder="Alamat" value="`+ usersObj[childId].alamat +`">
          </div>
          <div class="form-group">
            <h5 class="font-weight-bold mb-3"> RT </h5>
            <input type="text" class="form-control form-control-user" id="rt" placeholder="RT" value="`+ usersObj[childId].rt +`">
          </div>
          <div class="form-group">
            <h5 class="font-weight-bold mb-3"> RW </h5>
            <input type="text" class="form-control form-control-user" id="rw" placeholder="RW" value="`+ usersObj[childId].rw +`">
          </div>
          <div class="form-group">
            <h5 class="font-weight-bold mb-3"> Kelurahan / Desa </h5>
            <input type="text" class="form-control form-control-user" id="kelDes" placeholder="Kel / Desa" value="`+ usersObj[childId].kelDes +`">
          </div>
          <div class="form-group">
            <h5 class="font-weight-bold mb-3"> Kecamatan </h5>
            <input type="text" class="form-control form-control-user" id="kecamatan" placeholder="Kecamatan" value="`+ usersObj[childId].kecamatan +`">
          </div>
          <div class="form-group">
            <h5 class="font-weight-bold mb-3"> Agama </h5>
            <input type="text" class="form-control form-control-user" id="agama" placeholder="Agama" value="`+ usersObj[childId].agama +`">
          </div>
          <div class="form-group">
            <h5 class="font-weight-bold mb-3"> Status Perkawinan </h5>
            <input type="text" class="form-control form-control-user" id="status" placeholder="Status Perkawinan" value="`+ usersObj[childId].status +`">
          </div>
          <div class="form-group">
            <h5 class="font-weight-bold mb-3"> Pekerjaan </h5>
            <input type="text" class="form-control form-control-user" id="profesi" placeholder="Pekerjaan" value="`+ usersObj[childId].profesi +`">
          </div>
          <div class="form-group">
            <h5 class="font-weight-bold mb-3"> Kewarganegaraan </h5>
            <input type="text" class="form-control form-control-user" id="kNegara" placeholder="Kewarganegaraan" value="`+ usersObj[childId].kNegara +`">
          </div>
          <div class="form-group">
            <h5 class="font-weight-bold mb-3"> Jenis Identitas </h5>
            <select class="form-control" onchange="pilihJenis()" id="identitas" value="` +usersObj[childId].identitas+ `">
              <option name="home" id="home" value="home"> Pemilik Rumah </option>
              <option name="visitor" id="visitor" value="visitor"> Tamu </option>
            </select>
          </div>
          <div class="form-group" id="overlay" style="display: none;">
            <h5 class="font-weight-bold mb-3"> Kenalan </h5>
            <input type="search" class="form-control form-control-user" name="kenalan" id="kenalan" placeholder="Kenalan" value="`+usersObj[childId].kenalan+`">
          </div>
          <button id="submitBtn" class="btn btn-primary btn-user btn-block">
            Kirim
          </button> 
          <div class="text-center mt-4">
            <p class="small text-primary"> Make Sure u have input the right data! </p>
          </div>  
    </form>
    `);
  
  $('#submitBtn').click(function(){
        let idNFC, namaOrang, umurOrang, tpLahir, tgLahir, jKel, alamat, rt, rw, kelDes, kecamatan, agama, status, profesiOrang, kNegara, identitas, home, visitor, kenalan;
        idNFC = $('#idNFC').val();
        namaOrang = $('#namaOrang').val(); 
        umurOrang = $('#umur').val();
        tpLahir = $('#tpLahir').val();
        tgLahir = $('#tgLahir').val();
        jKel = $('#jKel').val();
        alamat = $('#alamat').val();
        rt = $('#rt').val();
        rw = $('#rw').val();
        kelDes = $('#kelDes').val();
        kecamatan = $('#kecamatan').val();
        agama = $('#agama').val();
        status = $('#status').val();
        profesiOrang = $('#profesi').val();
        kNegara = $('#kNegara').val();
        identitas = $('#identitas').val();
        kenalan = $('#kenalan').val();
        
        if( identitas === "home" ) {
          kenalan = "";
        } 
        db.ref('Users/' + idNFC).update({
          // Sebelah Kiri variabel buat file Firebase dan disebelah kanan variabel javascript(yang di atas)
          // NOTE : JANGAN DI HAPUS WOI(MASIH AWAM)
            nama : namaOrang,
            umur : umurOrang,
            tpLahir : tpLahir,
            tgLahir : tgLahir,
            jKel : jKel,
            alamat : alamat,
            rt : rt,
            rw : rw,
            kelDes : kelDes,
            kecamatan : kecamatan,
            agama : agama,
            status : status,
            profesi : profesiOrang,
            kNegara : kNegara,
            identitas : identitas,
            kenalan : kenalan

        }, function(error){
            if (error) {
                alert(error);
            } else {
                $('#idNFC').val('');
                $('#namaOrang').val('');
                $('#umur').val('');
                $('#tpLahir').val('');
                $('#tgLahir').val('');
                $('#jKel').val('');
                $('#alamat').val('');
                $('#RT').val('');
                $('#RW').val('');
                $('#kelDes').val('');
                $('#kecamatan').val('');
                $('#agama').val('');
                $('#status').val('');
                $('#profesi').val('');
                $('#kNegara').val('');
                $('#identitas').val('');
                $('#kenalan').val('');
                location.href = "charts.html";
                // location.href = "index2.html"; //pindah ke index.html
            }
        });

    });

  });
  // ------------------- END OF EDIT MODAL ------------------------------

  // -------------------------- DELETE MODAL ---------------------------
  $('#deleteModal').on('show.bs.modal', function(e) {
      let childId = $(e.relatedTarget).data('child-id');

      $('#modalDelete').append(`
        <p> Id NFC : ` + childId + `</p> 
        <p> Agama : ` + usersObj[childId].agama  + `</p>
        <p> Alamat : ` + usersObj[childId].alamat  + `</p>                     
        <p> Identitas : ` + usersObj[childId].identitas  + `</p>              
        <p> Jenis Kelamin : ` + usersObj[childId].jKel  + `</p>              
        <p> Kewarganegaraan : ` + usersObj[childId].kNegara  + `</p>              
        <p> Kecamatan : ` + usersObj[childId].kecamatan + `</p>              
        <p> Kelurahan / Desa : ` + usersObj[childId].kelDes + `</p>              
        <p> Kenalan : ` + usersObj[childId].kenalan + `</p>              
        <p> Nama : ` + usersObj[childId].nama + `</p>              
        <p> Profesi : ` + usersObj[childId].profesi + `</p>              
        <p> RT(Rukun Tetangga) : ` + usersObj[childId].rt + `</p>              
        <p> RW(Rukun Warga) : ` + usersObj[childId].rw + `</p>              
        <p> Status Perkawinan : ` + usersObj[childId].status + `</p>              
        <p> Tempat Lahir : ` + usersObj[childId].tpLahir + `</p>              
        <p> Tanggal Lahir : ` + usersObj[childId].tgLahir + `</p>              
        <p> Umur : ` + usersObj[childId].umur + `</p> 
        <p>R u sure u wanna delete this data, it wont appear again if u delete this data, u should input the new data again..</p>
        <p class="text-primary"> So make sure u have already make a right choice </p>
        <div class="modal-footer">
          <button class="btn btn-secondary" type="button" data-dismiss="modal">Cancel</button>
          <a class="btn btn-primary" href="charts.html" onclick="hapus('`+ childId +`')" >Delete</a>
        </div>   
      `); 
    });
  // ---------------------------------- END OF DELETE MODAL --------------------------------------

  $('#detailModal').on('hidden.bs.modal', function (e) {
    $('#modalDetails').empty();
  });

  $('#editModal').on('hidden.bs.modal', function (e) {
    $('#modalEdits').empty();
  });

  $('#deleteModal').on('hidden.bs.modal', function (e) {
    $('#modalDelete').empty();
  });
  
  function hapus(satuId) {
    db.ref('Users/' + satuId).remove();
    location.href = "charts.html";
  }

</script>


</body>

</html>
